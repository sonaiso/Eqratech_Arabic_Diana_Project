"""
Enhanced Masdar Semantic Engine
نظام تحليل المصادر الدلالي المحسّن

This engine implements a comprehensive phonetic-semantic classification system
for Arabic verbal nouns (مصادر) based on linguistic patterns and semantic domains.
"""

import pandas as pd
from base_reconstruction_engine import BaseReconstructionEngine
from reconstruction_utils import reconstruct_from_base_df

class MasdarSemanticEngine(BaseReconstructionEngine):
    """
    Enhanced engine for masdar semantic analysis with phonetic-semantic mapping.
    Maps morphological patterns to semantic domains with feature vectors.
    """
    
    SHEET_NAME = 'المصادر_التحليل_الدلالي'
    
    @classmethod
    def make_df(cls):
        """
        Generate comprehensive masdar dataset with semantic classification.
        Each entry includes:
        - Root, pattern, masdar form
        - Phonetic profile (vowel patterns)
        - Semantic domain and features
        - Examples and linguistic notes
        """
        
        rows = [
            # Physical Domain (المجال الحسي) - Pattern: فَعْل
            {
                "الأداة": "قَتْل",
                "الجذر": "قتل",
                "باب_الفعل": "فَعَلَ يَفْعُلُ",
                "الوزن": "فَعْل",
                "الفونيمات": "ق ت ل",
                "الحركات": "فتحة سكون",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "u",
                "المجال_الدلالي": "حسي فيزيائي",
                "التصنيف_الأساسي": "حدث",
                "الوظيفة الدلالية": "فعل مادي مباشر - أثر شديد",
                "السمات_الدلالية": "فيزيائية=1.0, إدراك=0.1, انفعال=0.3, تفاعل_اجتماعي=0.6",
                "التفسير_الصوتي_الدلالي": "الفتحة = انفتاح + مباشرة، السكون = حدة الفعل",
                "ملاحظات": "حدث حادّ محسوس - فعل مباشر على المفعول"
            },
            {
                "الأداة": "ضَرْب",
                "الجذر": "ضرب",
                "باب_الفعل": "فَعَلَ يَفْعِلُ",
                "الوزن": "فَعْل",
                "الفونيمات": "ض ر ب",
                "الحركات": "فتحة سكون",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "i",
                "المجال_الدلالي": "حسي فيزيائي",
                "التصنيف_الأساسي": "حدث",
                "الوظيفة الدلالية": "فعل مادي - أثر فيزيائي",
                "السمات_الدلالية": "فيزيائية=1.0, إدراك=0.0, قوة_الفاعل=0.9, أثر_المفعول=1.0",
                "التفسير_الصوتي_الدلالي": "نمط فَعْل يدل على الفعل المباشر المحسوس",
                "ملاحظات": "أثر مباشر وقوي"
            },
            {
                "الأداة": "كَسْر",
                "الجذر": "كسر",
                "باب_الفعل": "فَعَلَ يَفْعِلُ",
                "الوزن": "فَعْل",
                "الفونيمات": "ك س ر",
                "الحركات": "فتحة سكون",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "i",
                "المجال_الدلالي": "حسي فيزيائي",
                "التصنيف_الأساسي": "حدث",
                "الوظيفة الدلالية": "تدمير مادي - تغيير الحالة الفيزيائية",
                "السمات_الدلالية": "فيزيائية=1.0, أثر_المفعول=1.0, تغيير_الحالة=1.0",
                "التفسير_الصوتي_الدلالي": "الفعل الحادّ المباشر بأثر تدميري",
                "ملاحظات": "تغيير فيزيائي دائم في المفعول"
            },
            
            # Cognitive Domain (المجال العقلي) - Pattern: فِعْل
            {
                "الأداة": "عِلْم",
                "الجذر": "علم",
                "باب_الفعل": "فَعِلَ يَفْعَلُ",
                "الوزن": "فِعْل",
                "الفونيمات": "ع ل م",
                "الحركات": "كسرة سكون",
                "حركة_عين_الماضي": "i",
                "حركة_عين_المضارع": "a",
                "المجال_الدلالي": "عقلي معرفي",
                "التصنيف_الأساسي": "حالة ذهنية",
                "الوظيفة الدلالية": "حالة معرفية - إدراك ذهني مجرد",
                "السمات_الدلالية": "إدراك=1.0, فيزيائية=0.0, انفعال=0.2, امتداد=0.8",
                "التفسير_الصوتي_الدلالي": "الكسرة = انضغاط دلالي يؤدي للتجريد الذهني",
                "ملاحظات": "مجال معرفي محض - لا فيزيائية فيه"
            },
            {
                "الأداة": "فِقْه",
                "الجذر": "فقه",
                "باب_الفعل": "فَعِلَ يَفْعَلُ",
                "الوزن": "فِعْل",
                "الفونيمات": "ف ق ه",
                "الحركات": "كسرة سكون",
                "حركة_عين_الماضي": "i",
                "حركة_عين_المضارع": "a",
                "المجال_الدلالي": "عقلي معرفي",
                "التصنيف_الأساسي": "فهم عميق",
                "الوظيفة الدلالية": "إدراك عميق - فهم متقن",
                "السمات_الدلالية": "إدراك=1.0, عمق_الفهم=1.0, تجريد=0.9",
                "التفسير_الصوتي_الدلالي": "وزن فِعْل يدل على المعنى الذهني المجرد",
                "ملاحظات": "فهم أعمق من مجرد المعرفة"
            },
            {
                "الأداة": "حِفْظ",
                "الجذر": "حفظ",
                "باب_الفعل": "فَعِلَ يَفْعَلُ",
                "الوزن": "فِعْل",
                "الفونيمات": "ح ف ظ",
                "الحركات": "كسرة سكون",
                "حركة_عين_الماضي": "i",
                "حركة_عين_المضارع": "a",
                "المجال_الدلالي": "عقلي معرفي",
                "التصنيف_الأساسي": "احتفاظ ذهني",
                "الوظيفة الدلالية": "استبقاء معرفي - تخزين ذهني",
                "السمات_الدلالية": "إدراك=0.9, ذاكرة=1.0, امتداد=0.8",
                "التفسير_الصوتي_الدلالي": "الكسرة تدل على العملية الداخلية الذهنية",
                "ملاحظات": "عملية ذهنية بحتة - حفظ في الذاكرة"
            },
            
            # Emotional Domain (المجال الشعوري) - Pattern: فَعَل
            {
                "الأداة": "فَرَح",
                "الجذر": "فرح",
                "باب_الفعل": "فَعِلَ يَفْعَلُ",
                "الوزن": "فَعَل",
                "الفونيمات": "ف ر ح",
                "الحركات": "فتحة فتحة",
                "حركة_عين_الماضي": "i",
                "حركة_عين_المضارع": "a",
                "المجال_الدلالي": "شعوري وجداني",
                "التصنيف_الأساسي": "انفعال إيجابي",
                "الوظيفة الدلالية": "حالة انفعالية - سرور نفسي",
                "السمات_الدلالية": "انفعال=1.0, إدراك=0.3, فيزيائية=0.2",
                "التفسير_الصوتي_الدلالي": "كسرة عين الفعل تدل على الداخلية الوجدانية",
                "ملاحظات": "انفعال داخلي - حالة نفسية"
            },
            {
                "الأداة": "حُزْن",
                "الجذر": "حزن",
                "باب_الفعل": "فَعِلَ يَفْعَلُ",
                "الوزن": "فُعْل",
                "الفونيمات": "ح ز ن",
                "الحركات": "ضمة سكون",
                "حركة_عين_الماضي": "i",
                "حركة_عين_المضارع": "a",
                "المجال_الدلالي": "شعوري وجداني",
                "التصنيف_الأساسي": "انفعال سلبي",
                "الوظيفة الدلالية": "حالة انفعالية - كآبة نفسية",
                "السمات_الدلالية": "انفعال=1.0, امتداد=0.7, فيزيائية=0.1",
                "التفسير_الصوتي_الدلالي": "الضمة تدل على الامتلاء بالحالة الانفعالية",
                "ملاحظات": "حالة نفسية ممتدة"
            },
            {
                "الأداة": "غَضَب",
                "الجذر": "غضب",
                "باب_الفعل": "فَعِلَ يَفْعَلُ",
                "الوزن": "فَعَل",
                "الفونيمات": "غ ض ب",
                "الحركات": "فتحة فتحة",
                "حركة_عين_الماضي": "i",
                "حركة_عين_المضارع": "a",
                "المجال_الدلالي": "شعوري وجداني",
                "التصنيف_الأساسي": "انفعال قوي",
                "الوظيفة الدلالية": "حالة انفعالية شديدة - سخط نفسي",
                "السمات_الدلالية": "انفعال=1.0, شدة=0.9, فيزيائية=0.4",
                "التفسير_الصوتي_الدلالي": "كسرة الفعل + انفتاح المصدر = انفعال ظاهر",
                "ملاحظات": "انفعال قوي قد يظهر جسديا"
            },
            
            # Dynamic/Movement Domain (المجال الحركي) - Pattern: فُعُول
            {
                "الأداة": "صُعُود",
                "الجذر": "صعد",
                "باب_الفعل": "فَعَلَ يَفْعَلُ",
                "الوزن": "فُعُول",
                "الفونيمات": "ص ع و د",
                "الحركات": "ضمة ضمة",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "a",
                "المجال_الدلالي": "فيزيائي حركي",
                "التصنيف_الأساسي": "حركة انتقالية",
                "الوظيفة الدلالية": "حركة رأسية صاعدة - انتقال مكاني",
                "السمات_الدلالية": "حركة=1.0, فيزيائية=0.9, امتداد=0.9",
                "التفسير_الصوتي_الدلالي": "الضمة المكررة = امتداد الحركة واستمراريتها",
                "ملاحظات": "حركة منتظمة ممتدة"
            },
            {
                "الأداة": "نُزُول",
                "الجذر": "نزل",
                "باب_الفعل": "فَعَلَ يَفْعِلُ",
                "الوزن": "فُعُول",
                "الفونيمات": "ن ز و ل",
                "الحركات": "ضمة ضمة",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "i",
                "المجال_الدلالي": "فيزيائي حركي",
                "التصنيف_الأساسي": "حركة انتقالية",
                "الوظيفة الدلالية": "حركة رأسية هابطة - انتقال مكاني",
                "السمات_الدلالية": "حركة=1.0, فيزيائية=0.9, امتداد=0.9",
                "التفسير_الصوتي_الدلالي": "وزن فُعُول يدل على الحركة المستمرة",
                "ملاحظات": "حركة منتظمة في اتجاه واحد"
            },
            {
                "الأداة": "جُلُوس",
                "الجذر": "جلس",
                "باب_الفعل": "فَعَلَ يَفْعِلُ",
                "الوزن": "فُعُول",
                "الفونيمات": "ج ل و س",
                "الحركات": "ضمة ضمة",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "i",
                "المجال_الدلالي": "وجودي حالي",
                "التصنيف_الأساسي": "هيئة جسدية",
                "الوظيفة الدلالية": "وضعية جسدية - حالة فيزيائية",
                "السمات_الدلالية": "فيزيائية=0.8, حالة=1.0, امتداد=0.9",
                "التفسير_الصوتي_الدلالي": "فُعُول يدل على الهيئة الممتدة",
                "ملاحظات": "حالة جسدية ثابتة نسبيا"
            },
            
            # Social/Interaction Domain (المجال الاجتماعي) - Pattern: فِعَال
            {
                "الأداة": "قِتَال",
                "الجذر": "قتل",
                "باب_الفعل": "فَاعَلَ يُفَاعِلُ",
                "الوزن": "فِعَال",
                "الفونيمات": "ق ت ا ل",
                "الحركات": "كسرة فتحة",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "a",
                "المجال_الدلالي": "اجتماعي تفاعلي",
                "التصنيف_الأساسي": "تفاعل صراعي",
                "الوظيفة الدلالية": "تفاعل متبادل عنيف - صراع اجتماعي",
                "السمات_الدلالية": "تفاعل_اجتماعي=1.0, تبادلية=1.0, صراع=0.9, فيزيائية=0.9",
                "التفسير_الصوتي_الدلالي": "الكسرة = توتر داخلي، المد = امتداد التفاعل",
                "ملاحظات": "مشاركة متبادلة في فعل عنيف"
            },
            {
                "الأداة": "خِصَام",
                "الجذر": "خصم",
                "باب_الفعل": "فَاعَلَ يُفَاعِلُ",
                "الوزن": "فِعَال",
                "الفونيمات": "خ ص ا م",
                "الحركات": "كسرة فتحة",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "i",
                "المجال_الدلالي": "اجتماعي تفاعلي",
                "التصنيف_الأساسي": "نزاع كلامي",
                "الوظيفة الدلالية": "تفاعل متبادل في النزاع - جدال",
                "السمات_الدلالية": "تفاعل_اجتماعي=1.0, تبادلية=1.0, انفعال=0.7",
                "التفسير_الصوتي_الدلالي": "فِعَال يدل على المشاركة والتبادل",
                "ملاحظات": "نزاع لفظي متبادل"
            },
            {
                "الأداة": "جِدَال",
                "الجذر": "جدل",
                "باب_الفعل": "فَاعَلَ يُفَاعِلُ",
                "الوزن": "فِعَال",
                "الفونيمات": "ج د ا ل",
                "الحركات": "كسرة فتحة",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "i",
                "المجال_الدلالي": "اجتماعي تفاعلي",
                "التصنيف_الأساسي": "محاججة",
                "الوظيفة الدلالية": "تفاعل حجاجي - مناظرة عقلية",
                "السمات_الدلالية": "تفاعل_اجتماعي=0.9, إدراك=0.7, تبادلية=1.0",
                "التفسير_الصوتي_الدلالي": "وزن فِعَال للتفاعل الذهني المتبادل",
                "ملاحظات": "مناظرة فكرية متبادلة"
            },
            
            # Task/Production Domain (المجال الوظيفي) - Pattern: فِعَالَة
            {
                "الأداة": "كِتَابَة",
                "الجذر": "كتب",
                "باب_الفعل": "فَعَلَ يَفْعُلُ",
                "الوزن": "فِعَالَة",
                "الفونيمات": "ك ت ا ب ة",
                "الحركات": "كسرة فتحة",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "u",
                "المجال_الدلالي": "وظيفي إنتاجي",
                "التصنيف_الأساسي": "عمل ممتد",
                "الوظيفة الدلالية": "نشاط إنتاجي ذهني-حركي - مهارة",
                "السمات_الدلالية": "إنتاجية=1.0, إدراك=0.6, مهارة=0.8, عملية=1.0",
                "التفسير_الصوتي_الدلالي": "الكسرة = دقة، التاء المربوطة = استمرارية العمل",
                "ملاحظات": "عمل يتطلب مهارة ذهنية وحركية"
            },
            {
                "الأداة": "زِرَاعَة",
                "الجذر": "زرع",
                "باب_الفعل": "فَعَلَ يَفْعَلُ",
                "الوزن": "فِعَالَة",
                "الفونيمات": "ز ر ا ع ة",
                "الحركات": "كسرة فتحة",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "a",
                "المجال_الدلالي": "وظيفي إنتاجي",
                "التصنيف_الأساسي": "حرفة",
                "الوظيفة الدلالية": "نشاط إنتاجي ممتد - مهنة",
                "السمات_الدلالية": "إنتاجية=1.0, عملية=1.0, امتداد=0.9",
                "التفسير_الصوتي_الدلالي": "فِعَالَة يدل على النشاط المهني الممتد",
                "ملاحظات": "عمل منتج يحتاج وقتا ومهارة"
            },
            {
                "الأداة": "صِنَاعَة",
                "الجذر": "صنع",
                "باب_الفعل": "فَعَلَ يَفْعَلُ",
                "الوزن": "فِعَالَة",
                "الفونيمات": "ص ن ا ع ة",
                "الحركات": "كسرة فتحة",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "a",
                "المجال_الدلالي": "وظيفي إنتاجي",
                "التصنيف_الأساسي": "حرفة",
                "الوظيفة الدلالية": "نشاط حرفي متقن - مهنة تقنية",
                "السمات_الدلالية": "إنتاجية=1.0, مهارة=0.9, تقنية=0.9",
                "التفسير_الصوتي_الدلالي": "وزن فِعَالَة للحرفة والصنعة",
                "ملاحظات": "عمل حرفي يحتاج إتقان"
            },
            
            # Instance/Once Domain (اسم المرة) - Pattern: فَعْلَة
            {
                "الأداة": "ضَرْبَة",
                "الجذر": "ضرب",
                "باب_الفعل": "فَعَلَ يَفْعِلُ",
                "الوزن": "فَعْلَة",
                "الفونيمات": "ض ر ب ة",
                "الحركات": "فتحة سكون",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "i",
                "المجال_الدلالي": "حسي فيزيائي",
                "التصنيف_الأساسي": "مرة واحدة",
                "الوظيفة الدلالية": "حدوث واحد محدود - ضربة واحدة",
                "السمات_الدلالية": "فردية=1.0, محدودية=1.0, فيزيائية=1.0",
                "التفسير_الصوتي_الدلالي": "التاء المربوطة تحدد الفعل بمرة واحدة",
                "ملاحظات": "اسم المرة - حدث واحد محدد"
            },
            {
                "الأداة": "نَظْرَة",
                "الجذر": "نظر",
                "باب_الفعل": "فَعَلَ يَفْعُرُ",
                "الوزن": "فَعْلَة",
                "الفونيمات": "ن ظ ر ة",
                "الحركات": "فتحة سكون",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "u",
                "المجال_الدلالي": "حسي إدراكي",
                "التصنيف_الأساسي": "مرة واحدة",
                "الوظيفة الدلالية": "حدوث واحد - نظرة واحدة",
                "السمات_الدلالية": "فردية=1.0, محدودية=1.0, إدراك=0.7",
                "التفسير_الصوتي_الدلالي": "فَعْلَة للدلالة على المرة الواحدة",
                "ملاحظات": "اسم مرة - فعل بصري واحد"
            },
            {
                "الأداة": "فِكْرَة",
                "الجذر": "فكر",
                "باب_الفعل": "فَعَلَ يَفْعُلُ",
                "الوزن": "فِعْلَة",
                "الفونيمات": "ف ك ر ة",
                "الحركات": "كسرة سكون",
                "حركة_عين_الماضي": "a",
                "حركة_عين_المضارع": "u",
                "المجال_الدلالي": "عقلي معرفي",
                "التصنيف_الأساسي": "وحدة ذهنية",
                "الوظيفة الدلالية": "وحدة فكرية واحدة - خاطرة",
                "السمات_الدلالية": "فردية=1.0, إدراك=1.0, تجريد=0.9",
                "التفسير_الصوتي_الدلالي": "فِعْلَة للوحدة الذهنية المفردة",
                "ملاحظات": "وحدة ذهنية واحدة - مفهوم مفرد"
            },
        ]
        
        return reconstruct_from_base_df(pd.DataFrame(rows))


class MasdarPatternDomainEngine(BaseReconstructionEngine):
    """
    Reference table mapping morphological patterns to semantic domains.
    الجدول المرجعي للربط بين الأوزان والمجالات الدلالية
    """
    
    SHEET_NAME = 'الأوزان_المجالات_الدلالية'
    
    @classmethod
    def make_df(cls):
        """
        Generate pattern-domain mapping reference table.
        """
        
        rows = [
            {
                "الوزن": "فَعْل",
                "باب_الفعل": "فَعَلَ",
                "حركة_العين": "فتحة",
                "المجال_الدلالي_الغالب": "حسي فيزيائي",
                "التفسير_الصوتي_الدلالي": "الفتحة = انفتاح + سرعة + مباشرة",
                "أمثلة": "قَتْل، ضَرْب، كَسْر، قَطْع",
                "الخصائص": "فعل حاد محسوس، أثر مباشر"
            },
            {
                "الوزن": "فُعُول",
                "باب_الفعل": "فَعَلَ",
                "حركة_العين": "فتحة",
                "المجال_الدلالي_الغالب": "حركة - هيئة فيزيائية",
                "التفسير_الصوتي_الدلالي": "الضمة + السكون = امتداد وحركة منتظمة",
                "أمثلة": "صُعُود، نُزُول، جُلُوس، رُكُوب",
                "الخصائص": "حالة ممتدة فيزيائياً"
            },
            {
                "الوزن": "فِعَالَة",
                "باب_الفعل": "فَعَلَ",
                "حركة_العين": "فتحة",
                "المجال_الدلالي_الغالب": "عمل ممتد - حرفة",
                "التفسير_الصوتي_الدلالي": "الكسرة = دقة، الفتحة = إنتاج",
                "أمثلة": "كِتَابَة، زِرَاعَة، صِنَاعَة",
                "الخصائص": "نشاط إنتاجي (Task)"
            },
            {
                "الوزن": "فِعَال",
                "باب_الفعل": "فَعَلَ",
                "حركة_العين": "فتحة",
                "المجال_الدلالي_الغالب": "صراع - تفاعل اجتماعي",
                "التفسير_الصوتي_الدلالي": "كسرة = شدة داخلية + تفاعل",
                "أمثلة": "قِتَال، صِرَاع، خِصَام، جِدَال",
                "الخصائص": "مشاركة/صراع/انفعال اجتماعي"
            },
            {
                "الوزن": "فِعْلَة / فَعْلَة",
                "باب_الفعل": "فَعَلَ",
                "حركة_العين": "فتحة",
                "المجال_الدلالي_الغالب": "مرة واحدة",
                "التفسير_الصوتي_الدلالي": "الفتحة = حدوث واحد، السكون = انغلاق",
                "أمثلة": "ضَرْبَة، نَظْرَة، فِكْرَة",
                "الخصائص": "حدث محدود - اسم المرة"
            },
            {
                "الوزن": "فِعْل",
                "باب_الفعل": "فَعِلَ",
                "حركة_العين": "كسرة",
                "المجال_الدلالي_الغالب": "عقلي - ذهني",
                "التفسير_الصوتي_الدلالي": "الكسرة = انضغاط دلالي → ذهن",
                "أمثلة": "عِلْم، فِقْه، حِفْظ، ذِكْر",
                "الخصائص": "المعنى المجرد الذهني"
            },
            {
                "الوزن": "فَعَل",
                "باب_الفعل": "فَعِلَ",
                "حركة_العين": "كسرة",
                "المجال_الدلالي_الغالب": "شعوري - انفعالي",
                "التفسير_الصوتي_الدلالي": "الكسرة = داخلية، الفتحة = انفعال",
                "أمثلة": "فَرَح، غَضَب، حَزَن",
                "الخصائص": "حالة نفسية/وجدانية"
            },
            {
                "الوزن": "فُعْلَان",
                "باب_الفعل": "فَعُلَ",
                "حركة_العين": "ضمة",
                "المجال_الدلالي_الغالب": "حالة جسدية - وجدانية",
                "التفسير_الصوتي_الدلالي": "الضمة = امتلاء → حالة ممتدة",
                "أمثلة": "غُضْبَان، عَطْشَان، جَوْعَان",
                "الخصائص": "حالة مسببية ممتدة"
            },
            {
                "الوزن": "فَعَال",
                "باب_الفعل": "فَعَلَ",
                "حركة_العين": "فتحة",
                "المجال_الدلالي_الغالب": "معنوي ذهني - صوتي",
                "التفسير_الصوتي_الدلالي": "الحركة الطويلة = امتداد دلالي",
                "أمثلة": "كَلَام، خِطَاب",
                "الخصائص": "صوت أو معنى ممتد"
            },
        ]
        
        df = pd.DataFrame(rows)
        # No phonetic reconstruction needed for this reference table
        return df
